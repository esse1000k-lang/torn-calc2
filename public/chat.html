<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <meta name="theme-color" content="#0a0a0b">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="TornFi ì±„íŒ…">
  <title>ì‹¤ì‹œê°„ ì±„íŒ… - TornFi ì»¤ë®¤ë‹ˆí‹°</title>
  <link rel="icon" href="favicon.ico" type="image/x-icon">
  <link rel="apple-touch-icon" href="favicon.ico">
  <link rel="manifest" href="/manifest.json">
  <script src="js/pwa-env.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;600;700&family=Noto+Sans+KR:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/site.css">
</head>
<body class="chat-page">
  <nav class="site-nav">
    <div class="nav-brand">
      <a href="/" class="nav-logo">TornFi</a>
    </div>
    <a href="/admin.html" class="nav-admin-center" id="navAdminCenter" aria-label="ê´€ë¦¬ì" style="display:none;">ğŸ› ï¸</a>
    <div class="nav-menu-wrap">
      <button type="button" class="nav-menu-btn" id="navMenuBtn" aria-label="ë©”ë‰´" aria-expanded="false" aria-haspopup="true">â˜°</button>
      <div class="nav-menu-dropdown" id="navMenuDropdown" role="menu"></div>
    </div>
  </nav>

  <main class="site-main chat-page-main">
    <section id="chat" class="section chat-section">
      <div id="chatWrap" class="chat-wrap">
        <div id="chatPanel" class="chat-panel">
          <div id="chatMsgDropdown" class="chat-msg-dropdown" style="display:none;">
            <button type="button" class="chat-msg-dropdown__item" data-action="sendHeart"><span class="chat-msg-dropdown__icon">â¤ï¸</span> ì „ì†¡</button>
            <button type="button" class="chat-msg-dropdown__item" data-action="reply"><span class="chat-msg-dropdown__icon">â†©</span> ë‹µì¥</button>
            <button type="button" class="chat-msg-dropdown__item" data-action="copy"><span class="chat-msg-dropdown__icon chat-msg-dropdown__icon--copy"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg></span> ë³µì‚¬</button>
            <button type="button" class="chat-msg-dropdown__item" data-action="edit"><span class="chat-msg-dropdown__icon">âœ</span> ìˆ˜ì •</button>
            <button type="button" class="chat-msg-dropdown__item" data-action="delete"><span class="chat-msg-dropdown__icon">ğŸ—‘</span> ì‚­ì œ</button>
          </div>
          <div id="chatLinkConfirmDropdown" class="chat-link-confirm-dropdown" style="display:none;">
            <p class="chat-link-confirm__text">ëª¨í—˜ì„ ë– ë‚  ì¤€ë¹„ê°€ ë˜ì…¨ë‚˜ìš”?</p>
            <div class="chat-link-confirm__actions">
              <button type="button" id="chatLinkConfirmGo" class="chat-link-confirm__btn chat-link-confirm__btn--go">ì´ë™</button>
              <button type="button" id="chatLinkConfirmCancel" class="chat-link-confirm__btn chat-link-confirm__btn--cancel">ì·¨ì†Œ</button>
            </div>
          </div>
          <div id="chatItemUsedToast" class="chat-item-used-toast" aria-live="polite" style="display:none;"></div>
          <div id="chatRewardPartyOverlay" class="reward-party-overlay" aria-hidden="true" style="display:none;"
               data-helicopter-size="200" data-scatter-emoji="ğŸŒªï¸" data-fly-in-ms="2500" data-scatter-duration-ms="10000" data-fly-out-ms="2000" data-fade-out-ms="1000" data-scatter-interval-ms="180" data-scatter-fall-duration-s="6">
            <div class="reward-party-helicopter"></div>
            <div class="reward-party-scatter"></div>
          </div>
          <div id="chatRisePrayerOverlay" class="rise-prayer-overlay" aria-hidden="true" style="display:none;">
            <div class="rise-prayer-inner">
              <span class="rise-prayer-emoji" aria-hidden="true">ğŸ™</span>
              <p class="rise-prayer-text">TORN ë–¡ìƒê¸°ì›!!</p>
              <span class="rise-prayer-up" aria-hidden="true">ğŸš€</span>
            </div>
          </div>
          <div id="chatBroomOverlay" class="broom-overlay" aria-hidden="true" style="display:none;">
            <div class="broom-overlay__dust" aria-hidden="true">
              <span class="broom-dust-particle"></span><span class="broom-dust-particle"></span><span class="broom-dust-particle"></span><span class="broom-dust-particle"></span><span class="broom-dust-particle"></span><span class="broom-dust-particle"></span><span class="broom-dust-particle"></span><span class="broom-dust-particle"></span><span class="broom-dust-particle"></span><span class="broom-dust-particle"></span><span class="broom-dust-particle"></span><span class="broom-dust-particle"></span><span class="broom-dust-particle"></span><span class="broom-dust-particle"></span><span class="broom-dust-particle"></span><span class="broom-dust-particle"></span><span class="broom-dust-particle"></span><span class="broom-dust-particle"></span><span class="broom-dust-particle"></span><span class="broom-dust-particle"></span>
            </div>
            <div class="broom-overlay__broom" aria-hidden="true">ğŸ§¹</div>
          </div>
          <div id="chatPinnedWrap" class="chat-pinned-wrap" style="display:none;">
            <div class="chat-pinned-inner">
              <span class="chat-pinned-icon" aria-hidden="true">ğŸ“Œ</span>
              <button type="button" id="chatPinnedUnpinBtn" class="chat-pinned-unpin-btn" style="display:none;" title="ê³ ì • ë©”ì‹œì§€ í•´ì œ(ê´€ë¦¬ì)">ê³ ì • í•´ì œ</button>
              <p id="chatPinnedText" class="chat-pinned-text"></p>
              <span id="chatPinnedMeta" class="chat-pinned-meta"></span>
            </div>
          </div>
          <div class="chat-messages-area">
            <div id="chatGuestNotice" class="chat-guest-notice" style="display:none;" aria-live="polite"></div>
            <div id="chatMessages" class="chat-messages"></div>
          </div>
          <div id="chatReplyBar" class="chat-reply-bar" style="display:none;">
            <span id="chatReplyText" class="chat-reply-bar__text"></span>
            <button type="button" id="chatReplyCancel" class="chat-reply-bar__cancel">ì·¨ì†Œ</button>
          </div>
          <div class="chat-input-wrap">
            <input type="file" id="chatImage" class="chat-file-input" accept="image/jpeg,image/png,image/gif,image/webp" aria-label="ì‚¬ì§„ ì²¨ë¶€">
            <button type="button" id="chatAttach" class="chat-attach-btn" title="ì‚¬ì§„ ì²¨ë¶€" aria-label="ì‚¬ì§„ ì²¨ë¶€">ğŸ“·</button>
            <input type="text" id="chatInput" class="chat-input" placeholder="ë©”ì‹œì§€ ì…ë ¥ (ë¡œê·¸ì¸ í›„ ì „ì†¡)" maxlength="500" autocomplete="off">
            <div id="chatItemSelectWrap" class="chat-item-dropdown" style="display:none;" aria-label="ì•„ì´í…œ ì„ íƒ">
              <button type="button" id="chatItemTrigger" class="chat-item-trigger" aria-haspopup="true">â¤ï¸</button>
              <div class="chat-item-menu" id="chatItemMenu"></div>
            </div>
          <div id="chatShopConfirmLayer" class="chat-shop-confirm-layer" style="display:none;">
            <div class="chat-shop-confirm-box">
              <p class="chat-shop-confirm__text">ìƒì ìœ¼ë¡œ ì´ë™í•˜ì‹œê² ìŠµë‹ˆê¹Œ?</p>
              <div class="chat-shop-confirm__actions">
                <button type="button" id="chatShopConfirmNo" class="chat-shop-confirm__btn chat-shop-confirm__btn--no">ì•„ë‹ˆì˜¤</button>
                <button type="button" id="chatShopConfirmYes" class="chat-shop-confirm__btn chat-shop-confirm__btn--yes">ë„¤</button>
              </div>
            </div>
          </div>
            <button type="button" id="chatSend" class="chat-send">ì „ì†¡</button>
          </div>
          <div id="chatPreviewWrap" class="chat-preview-wrap" style="display:none;">
            <img id="chatPreviewImg" class="chat-preview-img" alt="ì²¨ë¶€ ë¯¸ë¦¬ë³´ê¸°">
            <button type="button" id="chatPreviewRemove" class="chat-preview-remove" aria-label="ì²¨ë¶€ ì·¨ì†Œ">Ã—</button>
          </div>
          <div id="chatPinModal" class="chat-pin-modal" role="dialog" aria-labelledby="chatPinModalTitle" aria-modal="true" style="display:none;">
            <div class="chat-pin-modal__backdrop"></div>
            <div class="chat-pin-modal__box">
              <p id="chatPinModalTitle" class="chat-pin-modal__emoji" aria-label="ìƒë‹¨ ê³ ì • ë©”ì‹œì§€">ğŸ“Œ</p>
              <textarea id="chatPinModalInput" class="chat-pin-modal__input" placeholder="ê³ ì •í•  ë©”ì‹œì§€ ì…ë ¥ (ìµœëŒ€ 25ì)" maxlength="25" rows="3"></textarea>
              <div class="chat-pin-modal__actions">
                <button type="button" id="chatPinModalCancel" class="chat-pin-modal__btn chat-pin-modal__btn--cancel">ì·¨ì†Œ</button>
                <button type="button" id="chatPinModalConfirm" class="chat-pin-modal__btn chat-pin-modal__btn--confirm">í™•ì¸</button>
              </div>
            </div>
          </div>
          <div id="chatEditModal" class="chat-edit-modal" role="dialog" aria-labelledby="chatEditModalTitle" aria-modal="true" style="display:none;">
            <div class="chat-edit-modal__backdrop"></div>
            <div class="chat-edit-modal__box">
              <p id="chatEditModalTitle" class="chat-edit-modal__title">âœ ë©”ì‹œì§€ ìˆ˜ì •</p>
              <textarea id="chatEditModalInput" class="chat-edit-modal__input" placeholder="ë‚´ìš© ì…ë ¥ (ìµœëŒ€ 500ì)" maxlength="500" rows="4"></textarea>
              <div class="chat-edit-modal__actions">
                <button type="button" id="chatEditModalCancel" class="chat-edit-modal__btn chat-edit-modal__btn--cancel">ì·¨ì†Œ</button>
                <button type="button" id="chatEditModalConfirm" class="chat-edit-modal__btn chat-edit-modal__btn--confirm">í™•ì¸</button>
              </div>
            </div>
          </div>
          <div id="chatDeleteModal" class="chat-delete-modal" role="dialog" aria-labelledby="chatDeleteModalTitle" aria-modal="true" style="display:none;">
            <div class="chat-delete-modal__backdrop"></div>
            <div class="chat-delete-modal__box">
              <p id="chatDeleteModalTitle" class="chat-delete-modal__title">ì´ ë©”ì‹œì§€ë¥¼ ì‚­ì œí• ê¹Œìš”?</p>
              <div class="chat-delete-modal__actions">
                <button type="button" id="chatDeleteModalCancel" class="chat-delete-modal__btn chat-delete-modal__btn--cancel">ì·¨ì†Œ</button>
                <button type="button" id="chatDeleteModalConfirm" class="chat-delete-modal__btn chat-delete-modal__btn--confirm">ì‚­ì œ</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
  </main>

  <div id="chatSendHeartLayer" class="chat-send-heart-layer" style="display:none;">
    <div class="chat-send-heart-box">
      <h3 class="chat-send-heart-title">â¤ï¸ í•˜íŠ¸ ë³´ë‚´ê¸°</h3>
      <p id="chatSendHeartMessage" class="chat-send-heart-message"></p>
      <p id="chatSendHeartMyHearts" class="chat-send-heart-myhearts"></p>
      <div class="chat-send-heart-actions">
        <button type="button" id="chatSendHeartCancel" class="chat-send-heart-btn chat-send-heart-btn--cancel">ì·¨ì†Œ</button>
        <button type="button" id="chatSendHeartOk" class="chat-send-heart-btn chat-send-heart-btn--ok">ë³´ë‚´ê¸°</button>
      </div>
    </div>
  </div>

  <script src="js/auth.js"></script>
  <script src="js/nav-logo.js"></script>
  <script>
    (function () {
      var navAdminCenter = document.getElementById('navAdminCenter');
      var navMenuBtn = document.getElementById('navMenuBtn');
      function updateNav(user) {
        if (user) {
          if (navMenuBtn) navMenuBtn.style.display = 'none';
          if (navAdminCenter) navAdminCenter.style.display = user.isAdmin ? 'inline-flex' : 'none';
        } else {
          if (navMenuBtn) navMenuBtn.style.display = 'none';
          if (navAdminCenter) navAdminCenter.style.display = 'none';
        }
      }
      if (window.TornFiAuth && window.TornFiAuth.onUser) {
        window.TornFiAuth.onUser(updateNav);
      }

      var navMenuBtn = document.getElementById('navMenuBtn');
      var navMenuDropdown = document.getElementById('navMenuDropdown');
      if (navMenuBtn && navMenuDropdown) {
        navMenuBtn.addEventListener('click', function (e) {
          e.stopPropagation();
          var open = navMenuDropdown.classList.toggle('is-open');
          navMenuBtn.setAttribute('aria-expanded', open);
        });
        navMenuDropdown.addEventListener('click', function (e) { e.stopPropagation(); });
        document.addEventListener('click', function () {
          navMenuDropdown.classList.remove('is-open');
          navMenuBtn.setAttribute('aria-expanded', 'false');
        });
      }
    })();
  </script>
  <script src="js/chat-page.js"></script>
  <script>
    /* ì˜¤ë²„ë ˆì´/í† ìŠ¤íŠ¸ê°€ í´ë¦­ì„ ê°€ë¡œì±„ëŠ”ì§€ í™•ì¸ìš© â€” í™•ì¸ í›„ ì´ ë¸”ë¡ ì‚­ì œ */
    setTimeout(function () {
      var ids = ['chatRewardPartyOverlay', 'chatRisePrayerOverlay', 'chatBroomOverlay', 'chatItemUsedToast'];
      console.log('[ì±„íŒ… ì˜¤ë²„ë ˆì´ ê²€ì‚¬]');
      ids.forEach(function (id) {
        var el = document.getElementById(id);
        if (!el) { console.log('  ' + id + ': ì—†ìŒ'); return; }
        var s = window.getComputedStyle(el);
        console.log('  ' + id + ':', 'display=' + s.display, 'pointerEvents=' + s.pointerEvents, 'visibility=' + s.visibility);
      });
    }, 2000);
  </script>
</body>
</html>
