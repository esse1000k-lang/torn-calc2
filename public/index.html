<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <meta name="theme-color" content="#0a0a0b">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="TornFi">
  <title>TornFi ì»¤ë®¤ë‹ˆí‹°</title>
  <link rel="icon" href="favicon.ico" type="image/x-icon">
  <link rel="apple-touch-icon" href="favicon.ico">
  <link rel="manifest" href="/manifest.json">
  <script src="js/pwa-env.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;600;700&family=Noto+Sans+KR:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/site.css">
</head>
<body>
  <nav class="site-nav">
    <div class="nav-brand">
      <a href="/" class="nav-logo">TornFi</a>
    </div>
    <a href="/admin.html" class="nav-admin-center" id="navAdminCenter" aria-label="ê´€ë¦¬ì" style="display:none;">ğŸ› ï¸</a>
    <div class="nav-menu-wrap">
      <button type="button" class="nav-menu-btn" id="navMenuBtn" aria-label="ë©”ë‰´" aria-expanded="false" aria-haspopup="true">â˜°</button>
      <div class="nav-menu-dropdown" id="navMenuDropdown" role="menu">
        <a href="/login.html" id="navLogin" role="menuitem" style="display:none;">ë¡œê·¸ì¸</a>
        <a href="/register.html" id="navRegister" role="menuitem" style="display:none;">íšŒì›ê°€ì…</a>
        <div class="nav-menu-user" id="navMenuUser" style="display:none;">
          <a href="/profile.html" id="navProfile" role="menuitem">ë‚´ ì •ë³´</a>
          <button type="button" id="navLogout" role="menuitem">ë¡œê·¸ì•„ì›ƒ</button>
        </div>
      </div>
    </div>
  </nav>

  <main class="site-main">
    <div class="mobile-home-menu" id="mobileHomeMenu" aria-label="ëª¨ë°”ì¼ í™ˆ ë©”ë‰´">
      <div class="mobile-home-menu__header">
        <a href="/board.html" class="mobile-home-menu__search" aria-label="ê²Œì‹œíŒ ê²€ìƒ‰">ê²€ìƒ‰</a>
      </div>
      <nav class="mobile-home-menu__grid" aria-label="ì„œë¹„ìŠ¤ ë©”ë‰´">
        <a href="/chat.html" class="mobile-home-menu__item">
          <span class="mobile-home-menu__icon" aria-hidden="true">ğŸ’¬</span>
          <span class="mobile-home-menu__label">ì‹¤ì‹œê°„ ì±„íŒ…</span>
        </a>
        <a href="/attendance.html" class="mobile-home-menu__item">
          <span class="mobile-home-menu__icon" aria-hidden="true">ğŸ“…</span>
          <span class="mobile-home-menu__label">ì¶œì„ì²´í¬</span>
        </a>
        <a href="/calculator.html" class="mobile-home-menu__item">
          <span class="mobile-home-menu__icon" aria-hidden="true">ğŸ”</span>
          <span class="mobile-home-menu__label">ë°°ë‹¹ ì¡°íšŒ</span>
        </a>
        <a href="/shop.html" class="mobile-home-menu__item">
          <span class="mobile-home-menu__icon" aria-hidden="true">â¤ï¸</span>
          <span class="mobile-home-menu__label">ìƒì </span>
        </a>
        <a href="/board.html" class="mobile-home-menu__item">
          <span class="mobile-home-menu__icon" aria-hidden="true">ğŸ“‹</span>
          <span class="mobile-home-menu__label">ê²Œì‹œíŒ</span>
        </a>
        <a href="/tornado-news.html" class="mobile-home-menu__item">
          <span class="mobile-home-menu__icon" aria-hidden="true">ğŸŒªï¸</span>
          <span class="mobile-home-menu__label">í† ë„¤ì´ë„ ë‰´ìŠ¤</span>
        </a>
        <a href="/ranking.html" class="mobile-home-menu__item">
          <span class="mobile-home-menu__icon" aria-hidden="true">ğŸ†</span>
          <span class="mobile-home-menu__label">ë­í‚¹</span>
        </a>
      </nav>
      <div class="mobile-home-menu__actions">
        <a href="/login.html" class="mobile-home-menu__btn mobile-home-menu__btn--primary" id="mobileHomeLogin">ë¡œê·¸ì¸</a>
        <a href="/register.html" class="mobile-home-menu__btn mobile-home-menu__btn--secondary" id="mobileHomeRegister">íšŒì›ê°€ì…</a>
        <a href="/profile.html" class="mobile-home-menu__btn mobile-home-menu__btn--primary" id="mobileHomeProfile" style="display:none; grid-column: 1 / -1;">ë‚´ ì •ë³´</a>
      </div>
    </div>
    <section id="community" class="section">
      <h2 class="section-title">ì»¤ë®¤ë‹ˆí‹° Â· ê²Œì‹œíŒ</h2>
      <div class="card community-card">
        <p>íšŒì›ê°€ì… í›„ ê¸€ì„ ì‘ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
        <div id="boardPreview" style="margin-top:1rem;">
          <p class="text-muted" id="boardPreviewLoading">ìµœê·¼ ê¸€ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦</p>
          <ul id="boardPreviewList" style="list-style:none; display:none;"></ul>
          <p id="boardPreviewEmpty" class="text-muted" style="display:none;">ì•„ì§ ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</p>
        </div>
        <p style="margin-top:1rem;"><a href="/board.html" style="color:var(--neon);">ê²Œì‹œíŒ ì „ì²´ ë³´ê¸° â†’</a></p>
      </div>
    </section>
  </main>

  <footer class="site-footer">
    Copyright 2025-2026 TornFi. All rights reserved.
    <div class="site-footer-withdraw" id="footerWithdrawWrap" style="display:none;">
      <button type="button" id="footerWithdrawBtn">íšŒì›íƒˆí‡´</button>
    </div>
  </footer>

  <div id="withdrawConfirmLayer" class="withdraw-confirm-layer" style="display:none;">
    <div class="withdraw-confirm-box">
      <h3>íšŒì›íƒˆí‡´</h3>
      <p class="withdraw-confirm-warn">íƒˆí‡´í•œ ì§€ê°‘ìœ¼ë¡œëŠ” ì¬ê°€ì…í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì •ë§ íƒˆí‡´í•˜ì‹œê² ìŠµë‹ˆê¹Œ?</p>
      <label class="withdraw-confirm-pin-label" for="withdrawConfirmPassword">ë¡œê·¸ì¸ ë¹„ë°€ë²ˆí˜¸</label>
      <input type="password" id="withdrawConfirmPassword" placeholder="ë¡œê·¸ì¸ ë¹„ë°€ë²ˆí˜¸" autocomplete="current-password" class="withdraw-confirm-pin-input" aria-label="ë¡œê·¸ì¸ ë¹„ë°€ë²ˆí˜¸" style="letter-spacing:normal;">
      <p id="withdrawConfirmPasswordErr" class="withdraw-confirm-pin-err" style="display:none;"></p>
      <div class="withdraw-confirm-actions">
        <button type="button" id="withdrawConfirmCancel" class="btn-cancel">ì·¨ì†Œ</button>
        <button type="button" id="withdrawConfirmOk" class="btn-confirm">íƒˆí‡´í•˜ê¸°</button>
      </div>
    </div>
  </div>

  <div id="withdrawnGoodbyeLayer" class="withdrawn-goodbye-layer" style="display:none;">
    <div class="withdrawn-goodbye-card">
      <div class="withdrawn-goodbye-icon" aria-hidden="true">ğŸ‘‹</div>
      <h2 class="withdrawn-goodbye-title">ê·¸ë™ì•ˆ ì´ìš©í•´ ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤</h2>
      <p class="withdrawn-goodbye-desc">TornFi ì»¤ë®¤ë‹ˆí‹°ì™€ í•¨ê»˜í•´ ì£¼ì…”ì„œ ê°ì‚¬í–ˆìŠµë‹ˆë‹¤.<br>ì•ìœ¼ë¡œë„ ì¢‹ì€ ì¼ë§Œ ê°€ë“í•˜ì‹œê¸¸ ë°”ëë‹ˆë‹¤.</p>
      <p class="withdrawn-goodbye-bye">ê³ ë§™ìŠµë‹ˆë‹¤.</p>
      <a href="/" id="withdrawnGoodbyeBtn" class="withdrawn-goodbye-btn">í™•ì¸</a>
    </div>
  </div>

  <script src="js/auth.js"></script>
  <script src="js/nav-logo.js"></script>
  <script>
    (function () {
      var navLogin = document.getElementById('navLogin');
      var navRegister = document.getElementById('navRegister');
      var navProfile = document.getElementById('navProfile');
      var navMenuUser = document.getElementById('navMenuUser');
      var navAdminCenter = document.getElementById('navAdminCenter');
      var mobileHomeLogin = document.getElementById('mobileHomeLogin');
      var mobileHomeRegister = document.getElementById('mobileHomeRegister');
      var mobileHomeProfile = document.getElementById('mobileHomeProfile');
      function updateNav(user) {
        if (user) {
          if (navLogin) navLogin.style.display = 'none';
          if (navRegister) navRegister.style.display = 'none';
          if (navMenuUser) navMenuUser.style.display = 'block';
          if (navProfile) navProfile.style.display = 'block';
          if (navAdminCenter) navAdminCenter.style.display = user.isAdmin ? 'inline-flex' : 'none';
          if (mobileHomeLogin) mobileHomeLogin.style.display = 'none';
          if (mobileHomeRegister) mobileHomeRegister.style.display = 'none';
          if (mobileHomeProfile) mobileHomeProfile.style.display = 'block';
        } else {
          if (navLogin) navLogin.style.display = 'block';
          if (navRegister) navRegister.style.display = 'block';
          if (navMenuUser) navMenuUser.style.display = 'none';
          if (navProfile) navProfile.style.display = 'none';
          if (navAdminCenter) navAdminCenter.style.display = 'none';
          if (mobileHomeLogin) mobileHomeLogin.style.display = 'block';
          if (mobileHomeRegister) mobileHomeRegister.style.display = 'block';
          if (mobileHomeProfile) mobileHomeProfile.style.display = 'none';
        }
      }
      window.TornFiAuth.onUser(function (user) {
        updateNav(user);
        var wrap = document.getElementById('footerWithdrawWrap');
        if (wrap) wrap.style.display = user ? 'block' : 'none';
      });

      var navMenuBtn = document.getElementById('navMenuBtn');
      var navMenuDropdown = document.getElementById('navMenuDropdown');
      if (navMenuBtn && navMenuDropdown) {
        navMenuBtn.addEventListener('click', function (e) {
          e.stopPropagation();
          var open = navMenuDropdown.classList.toggle('is-open');
          navMenuBtn.setAttribute('aria-expanded', open);
        });
        navMenuDropdown.addEventListener('click', function (e) { e.stopPropagation(); });
        document.addEventListener('click', function () {
          navMenuDropdown.classList.remove('is-open');
          navMenuBtn.setAttribute('aria-expanded', 'false');
        });
      }
      var navLogout = document.getElementById('navLogout');
      if (navLogout) {
        navLogout.addEventListener('click', function (e) {
          e.preventDefault();
          if (!confirm('ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
          window.TornFiAuth.logout().then(function () { updateNav(null); window.location.href = '/'; });
        });
      }

      (function setupWithdrawConfirm() {
        var layer = document.getElementById('withdrawConfirmLayer');
        var btn = document.getElementById('footerWithdrawBtn');
        var cancelBtn = document.getElementById('withdrawConfirmCancel');
        var okBtn = document.getElementById('withdrawConfirmOk');
        var passwordInput = document.getElementById('withdrawConfirmPassword');
        var passwordErr = document.getElementById('withdrawConfirmPasswordErr');
        if (!layer || !btn || !okBtn) return;
        btn.addEventListener('click', function () {
          if (passwordInput) passwordInput.value = '';
          if (passwordErr) { passwordErr.style.display = 'none'; passwordErr.textContent = ''; }
          layer.style.display = 'flex';
          if (passwordInput) passwordInput.focus();
        });
        cancelBtn.addEventListener('click', function () {
          layer.style.display = 'none';
        });
        okBtn.addEventListener('click', function () {
          var passwordVal = passwordInput ? passwordInput.value : '';
          if (!passwordVal.trim()) {
            if (passwordErr) { passwordErr.textContent = 'ë¡œê·¸ì¸ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”.'; passwordErr.style.display = 'block'; }
            return;
          }
          if (passwordErr) { passwordErr.style.display = 'none'; passwordErr.textContent = ''; }
          okBtn.disabled = true;
          fetch('/api/withdraw', {
            method: 'POST',
            credentials: 'same-origin',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ password: passwordVal }),
          })
            .then(function (r) { return r.json(); })
            .then(function (data) {
              okBtn.disabled = false;
              if (data.ok) {
                layer.style.display = 'none';
                window.TornFiAuth.logout().then(function () {
                  window.location.href = '/?withdrawn=1';
                });
              } else {
                if (passwordErr) { passwordErr.textContent = data.message || 'íƒˆí‡´ ì²˜ë¦¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.'; passwordErr.style.display = 'block'; }
              }
            })
            .catch(function () {
              layer.style.display = 'none';
              okBtn.disabled = false;
              alert('ìš”ì²­ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            });
        });
      })();

      (function setupWithdrawnGoodbye() {
        var params = new URLSearchParams(window.location.search);
        if (params.get('withdrawn') !== '1') return;
        var layer = document.getElementById('withdrawnGoodbyeLayer');
        var btn = document.getElementById('withdrawnGoodbyeBtn');
        if (!layer) return;
        layer.style.display = 'flex';
        if (btn) {
          btn.addEventListener('click', function (e) {
            e.preventDefault();
            layer.style.display = 'none';
            history.replaceState(null, '', window.location.pathname || '/');
          });
        }
      })();

      (function loadBoardPreview() {
        var loading = document.getElementById('boardPreviewLoading');
        var listEl = document.getElementById('boardPreviewList');
        var emptyEl = document.getElementById('boardPreviewEmpty');
        if (!loading || !listEl) return;
        fetch('/api/posts?limit=5&offset=0', { credentials: 'same-origin' })
          .then(function (r) { return r.json(); })
          .then(function (data) {
            if (!data.ok) { loading.style.display = 'none'; emptyEl.style.display = 'block'; return; }
            var posts = data.posts || [];
            loading.style.display = 'none';
            if (posts.length === 0) {
              emptyEl.style.display = 'block';
              return;
            }
            listEl.style.display = 'block';
            listEl.innerHTML = posts.map(function (p) {
              var date = p.createdAt ? new Date(p.createdAt).toLocaleDateString('ko-KR') : '';
              return '<li style="margin-bottom:0.5rem;"><a href="/board.html#' + p.id + '" style="color:var(--text);">' + (p.title || '').substring(0, 40) + (p.title && p.title.length > 40 ? 'â€¦' : '') + '</a> <span style="color:var(--text-muted); font-size:0.8rem;">' + (p.authorDisplayName || '') + ' Â· ' + date + '</span></li>';
            }).join('');
          })
          .catch(function () { loading.style.display = 'none'; emptyEl.style.display = 'block'; });
      })();
    })();
  </script>
</body>
</html>
