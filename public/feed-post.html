<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <meta name="theme-color" content="#0a0a0b">
  <title>í”¼ë“œ ê¸€ | TornFi</title>
  <link rel="icon" href="favicon.ico" type="image/x-icon">
  <link rel="stylesheet" href="css/site.css">
  <style>
    .feed-post-page { max-width: 100%; margin: 0 auto; padding: 0 0.5rem 5rem; box-sizing: border-box; }
    .feed-post-page .feed-card { border: none; overflow: visible; background: transparent; }
    .feed-post-page .feed-card__link {
      display: block; padding: 1rem 1.25rem; margin-bottom: 0.75rem;
      background: var(--bg-card); border: 1px solid var(--border); border-radius: 12px;
    }
    .feed-post-page .feed-card__body { margin-top: 0.35rem; }
    .feed-post-page .feed-card__body-full { white-space: pre-wrap; word-break: break-word; font-size: 0.95rem; line-height: 1.5; color: var(--text); }
    .feed-post-page .feed-card__actions { margin-top: 0.5rem; padding-top: 0.5rem; gap: 0.5rem 0.75rem; font-size: 0.8rem; }
    .feed-post-page .feed-card__comments { margin: 0; padding: 0; background: transparent; }
    .feed-post-page .feed-card__comment-form {
      margin-top: 0; margin-bottom: 0.75rem; gap: 0.5rem;
      padding: 0.65rem 0.85rem;
      background: rgba(0, 255, 136, 0.04); border: 1px solid rgba(0, 255, 136, 0.15); border-radius: 12px;
      position: relative;
      overflow: hidden;
    }
    .feed-post-page .feed-card__comment-form::before {
      content: '';
      position: absolute;
      top: 0; left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(0, 255, 136, 0.08), transparent);
      animation: feed-comment-form-shine 5s ease-in-out infinite;
      pointer-events: none;
    }
    @keyframes feed-comment-form-shine {
      0%, 100% { transform: translateX(0); opacity: 0; }
      50% { transform: translateX(200%); opacity: 1; }
    }
    .feed-post-page .feed-card__comments-list {
      margin: 0; padding: 1rem 1.25rem;
      background: var(--bg-card); border: 1px solid var(--border); border-radius: 12px;
      list-style: none;
    }
    .feed-post-page .feed-comment__date { font-size: 0.8rem; }
    .feed-post-page .feed-comment__text { font-size: 0.95rem; line-height: 1.5; }
    .feed-post-page .feed-comment__footer { font-size: 0.8rem; }
    @media (max-width: 768px) {
      .feed-post-page { padding-left: 0.35rem; padding-right: 0.35rem; }
      .feed-post-page .feed-card__link { padding: 1rem 1rem; }
      .feed-post-page .feed-card__comments-list { padding: 1rem; }
    }
    /* í”Œë¡œíŒ… ë²„íŠ¼ (í•˜ë‹¨ ì¤‘ì•™) */
    @keyframes feed-post-fab-float {
      0%, 100% { transform: translate(-50%, 0); }
      50% { transform: translate(-50%, -6px); }
    }
    .feed-post-fab {
      position: fixed;
      bottom: max(1rem, env(safe-area-inset-bottom));
      left: 50%;
      transform: translateX(-50%);
      z-index: 90;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      min-width: 52px;
      min-height: 52px;
      padding: 0 1rem;
      background: var(--bg-card);
      border: 1px solid var(--neon);
      border-radius: 999px;
      color: var(--neon);
      font-size: 0.9rem;
      font-weight: 600;
      text-decoration: none;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4), 0 0 0 1px rgba(0, 255, 136, 0.15);
      transition: background 0.2s, box-shadow 0.2s;
      -webkit-tap-highlight-color: transparent;
      animation: feed-post-fab-float 3s ease-in-out infinite;
    }
    .feed-post-fab:hover { background: rgba(0, 255, 136, 0.12); box-shadow: 0 6px 24px rgba(0, 0, 0, 0.45), 0 0 12px rgba(0, 255, 136, 0.2); }
    .feed-post-fab:active { transform: translate(-50%, 0) scale(0.98); animation-play-state: paused; }
  </style>
</head>
<body>
  <nav class="site-nav">
    <div class="nav-brand">
      <a href="/" class="nav-logo">TornFi</a>
    </div>
    <a href="/admin.html" class="nav-admin-center" id="navAdminCenter" aria-label="ê´€ë¦¬ì" style="display:none;">ğŸ› ï¸</a>
    <div class="nav-menu-wrap">
      <button type="button" class="nav-menu-btn" id="navMenuBtn" aria-label="ë©”ë‰´" aria-expanded="false" aria-haspopup="true">â˜°</button>
      <div class="nav-menu-dropdown" id="navMenuDropdown" role="menu"></div>
    </div>
  </nav>

  <main class="site-main site-main--feed-post">
    <div class="feed-post-page">
      <div id="feedPostRoot"></div>
    </div>
    <a href="/" class="feed-post-fab" id="feedPostFab" aria-label="í”¼ë“œ ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸°">â† í”¼ë“œ</a>
    <div id="feedAuthorPopover" class="feed-author-popover" role="tooltip" aria-hidden="true" style="display:none;">
      <div class="feed-author-popover__inner">
        <div class="feed-author-popover__avatar-wrap"></div>
        <div class="feed-author-popover__name"></div>
        <div class="feed-author-popover__level"></div>
        <div class="feed-author-popover__hearts"></div>
        <p class="feed-author-popover__bio"></p>
      </div>
    </div>
    <div id="feedSendHeartLayer" class="feed-send-heart-layer" style="display:none;">
      <div class="feed-send-heart-box">
        <h3 class="feed-send-heart-title">â¤ï¸ í•˜íŠ¸ ë³´ë‚´ê¸°</h3>
        <p id="feedSendHeartMessage" class="feed-send-heart-message"></p>
        <p id="feedSendHeartMyHearts" class="feed-send-heart-myhearts"></p>
        <div class="feed-send-heart-actions">
          <button type="button" id="feedSendHeartCancel" class="feed-send-heart-btn feed-send-heart-btn--cancel">ì·¨ì†Œ</button>
          <button type="button" id="feedSendHeartOk" class="feed-send-heart-btn feed-send-heart-btn--ok">ë³´ë‚´ê¸°</button>
        </div>
      </div>
    </div>
    <div id="feedDeleteConfirmLayer" class="feed-delete-confirm-layer" style="display:none;" aria-modal="true" role="dialog" aria-labelledby="feedDeleteConfirmTitlePost">
      <div class="feed-delete-confirm-box">
        <h3 id="feedDeleteConfirmTitlePost" class="feed-delete-confirm-title">ëŒ“ê¸€ ì‚­ì œ</h3>
        <p class="feed-delete-confirm-msg">ì´ ëŒ“ê¸€ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?</p>
        <div class="feed-delete-confirm-actions">
          <button type="button" id="feedDeleteConfirmCancel" class="feed-delete-confirm-btn feed-delete-confirm-btn--cancel">ì·¨ì†Œ</button>
          <button type="button" id="feedDeleteConfirmOk" class="feed-delete-confirm-btn feed-delete-confirm-btn--ok">ì‚­ì œ</button>
        </div>
      </div>
    </div>
    <div id="feedAdminPinLayer" class="feed-admin-pin-layer" style="display:none;" aria-modal="true" role="dialog" aria-labelledby="feedAdminPinTitlePost">
      <div class="feed-admin-pin-box">
        <h3 id="feedAdminPinTitlePost" class="feed-delete-confirm-title">ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸</h3>
        <p class="feed-admin-pin-desc">ì‚­ì œë¥¼ ìœ„í•´ 6ìë¦¬ ìˆ«ìë¥¼ ì…ë ¥í•˜ì„¸ìš”.</p>
        <p id="feedAdminPinErr" class="feed-admin-pin-err" style="display:none;"></p>
        <input type="password" id="feedAdminPinInput" class="feed-admin-pin-input" inputmode="numeric" pattern="[0-9]*" maxlength="6" placeholder="******" autocomplete="off" aria-label="ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸">
        <div class="feed-delete-confirm-actions">
          <button type="button" id="feedAdminPinCancel" class="feed-delete-confirm-btn feed-delete-confirm-btn--cancel">ì·¨ì†Œ</button>
          <button type="button" id="feedAdminPinOk" class="feed-delete-confirm-btn feed-delete-confirm-btn--ok">í™•ì¸</button>
        </div>
      </div>
    </div>
    <div id="feedAlertLayer" class="feed-alert-layer" style="display:none;" aria-modal="true" role="dialog" aria-labelledby="feedAlertTitle">
      <div class="feed-alert-box">
        <h3 id="feedAlertTitle" class="feed-alert-title">ì•Œë¦¼</h3>
        <p id="feedAlertMessage" class="feed-alert-message"></p>
        <div class="feed-alert-actions">
          <button type="button" id="feedAlertOk" class="feed-delete-confirm-btn feed-delete-confirm-btn--ok">í™•ì¸</button>
        </div>
      </div>
    </div>
  </main>

  <footer class="site-footer">
    Copyright 2025-2026 TornFi. All rights reserved.
    <div class="site-footer-withdraw" id="footerWithdrawWrap" style="display:none;">
      <button type="button" id="footerWithdrawBtn">íšŒì›íƒˆí‡´</button>
    </div>
  </footer>

  <div id="withdrawConfirmLayer" class="withdraw-confirm-layer" style="display:none;">
    <div class="withdraw-confirm-box">
      <h3>íšŒì›íƒˆí‡´</h3>
      <p class="withdraw-confirm-warn">íƒˆí‡´í•œ ì§€ê°‘ìœ¼ë¡œëŠ” ì¬ê°€ì…í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì •ë§ íƒˆí‡´í•˜ì‹œê² ìŠµë‹ˆê¹Œ?</p>
      <label class="withdraw-confirm-pin-label" for="withdrawConfirmPassword">ë¡œê·¸ì¸ ë¹„ë°€ë²ˆí˜¸</label>
      <input type="password" id="withdrawConfirmPassword" placeholder="ë¡œê·¸ì¸ ë¹„ë°€ë²ˆí˜¸" autocomplete="current-password" class="withdraw-confirm-pin-input" aria-label="ë¡œê·¸ì¸ ë¹„ë°€ë²ˆí˜¸" style="letter-spacing:normal;">
      <p id="withdrawConfirmPasswordErr" class="withdraw-confirm-pin-err" style="display:none;"></p>
      <div class="withdraw-confirm-actions">
        <button type="button" id="withdrawConfirmCancel" class="btn-cancel">ì·¨ì†Œ</button>
        <button type="button" id="withdrawConfirmOk" class="btn-confirm">íƒˆí‡´í•˜ê¸°</button>
      </div>
    </div>
  </div>

  <div id="withdrawnGoodbyeLayer" class="withdrawn-goodbye-layer" style="display:none;">
    <div class="withdrawn-goodbye-card">
      <div class="withdrawn-goodbye-icon" aria-hidden="true">ğŸ‘‹</div>
      <h2 class="withdrawn-goodbye-title">ê·¸ë™ì•ˆ ì´ìš©í•´ ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤</h2>
      <p class="withdrawn-goodbye-desc">TornFi ì»¤ë®¤ë‹ˆí‹°ì™€ í•¨ê»˜í•´ ì£¼ì…”ì„œ ê°ì‚¬í–ˆìŠµë‹ˆë‹¤.<br>ì•ìœ¼ë¡œë„ ì¢‹ì€ ì¼ë§Œ ê°€ë“í•˜ì‹œê¸¸ ë°”ëë‹ˆë‹¤.</p>
      <p class="withdrawn-goodbye-bye">ê³ ë§™ìŠµë‹ˆë‹¤.</p>
      <a href="/" id="withdrawnGoodbyeBtn" class="withdrawn-goodbye-btn">í™•ì¸</a>
    </div>
  </div>

  <script src="js/pwa-env.js"></script>
  <script src="js/auth.js"></script>
  <script src="js/nav-logo.js"></script>
  <script src="js/feed-post.js"></script>
  <script>
    (function () {
      function updateFooter(user) {
        var wrap = document.getElementById('footerWithdrawWrap');
        if (wrap) wrap.style.display = user ? 'block' : 'none';
      }
      if (window.TornFiAuth && window.TornFiAuth.onUser) {
        window.TornFiAuth.onUser(updateFooter);
      }

      (function setupWithdrawConfirm() {
        var layer = document.getElementById('withdrawConfirmLayer');
        var btn = document.getElementById('footerWithdrawBtn');
        var cancelBtn = document.getElementById('withdrawConfirmCancel');
        var okBtn = document.getElementById('withdrawConfirmOk');
        var passwordInput = document.getElementById('withdrawConfirmPassword');
        var passwordErr = document.getElementById('withdrawConfirmPasswordErr');
        if (!layer || !btn || !okBtn) return;
        btn.addEventListener('click', function () {
          if (passwordInput) passwordInput.value = '';
          if (passwordErr) { passwordErr.style.display = 'none'; passwordErr.textContent = ''; }
          layer.style.display = 'flex';
          if (passwordInput) passwordInput.focus();
        });
        if (cancelBtn) cancelBtn.addEventListener('click', function () { layer.style.display = 'none'; });
        okBtn.addEventListener('click', function () {
          var passwordVal = passwordInput ? passwordInput.value : '';
          if (!passwordVal.trim()) {
            if (passwordErr) { passwordErr.textContent = 'ë¡œê·¸ì¸ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”.'; passwordErr.style.display = 'block'; }
            return;
          }
          if (passwordErr) { passwordErr.style.display = 'none'; passwordErr.textContent = ''; }
          okBtn.disabled = true;
          fetch('/api/withdraw', {
            method: 'POST',
            credentials: 'same-origin',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ password: passwordVal }),
          })
            .then(function (r) { return r.json(); })
            .then(function (data) {
              okBtn.disabled = false;
              if (data.ok) {
                layer.style.display = 'none';
                window.TornFiAuth.logout().then(function () { window.location.href = '/?withdrawn=1'; });
              } else {
                if (passwordErr) { passwordErr.textContent = data.message || 'íƒˆí‡´ ì²˜ë¦¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.'; passwordErr.style.display = 'block'; }
              }
            })
            .catch(function () {
              layer.style.display = 'none';
              okBtn.disabled = false;
              alert('ìš”ì²­ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            });
        });
      })();

      (function setupWithdrawnGoodbye() {
        var params = new URLSearchParams(window.location.search);
        if (params.get('withdrawn') !== '1') return;
        var layer = document.getElementById('withdrawnGoodbyeLayer');
        var btn = document.getElementById('withdrawnGoodbyeBtn');
        if (!layer) return;
        layer.style.display = 'flex';
        if (btn) btn.addEventListener('click', function (e) {
          e.preventDefault();
          layer.style.display = 'none';
          history.replaceState(null, '', window.location.pathname || '/');
        });
      })();
    })();
  </script>
</body>
</html>
